<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เกมปริศนาเวกเตอร์</title>
    <!-- โหลด Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">

    <!-- โหลดและตั้งค่า MathJax -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    // Typeset หน้าที่แสดงผลครั้งแรก
                    if (document.getElementById('game1')) {
                        MathJax.typesetPromise([document.getElementById('game1')]);
                    }
                }
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <style>
        /* ใช้ฟอนต์ Sarabun */
        body {
            font-family: 'Sarabun', sans-serif;
        }
        /* ซ่อน/แสดงแท็บ */
        .tab-content.hidden {
            display: none;
        }
        /* สไตล์สำหรับแท็บที่ถูกเลือก */
        .tab-button.active {
            border-bottom-color: #3b82f6; /* blue-500 */
            color: #3b82f6;
            font-weight: 700;
        }
        /* สไตล์สำหรับ input */
        .game-input {
            @apply border border-gray-300 rounded-md p-2 w-24 text-center transition-all duration-200;
        }
        .game-input:focus {
            @apply border-blue-500 ring-2 ring-blue-200 outline-none;
        }
        /* สไตล์สำหรับปุ่ม */
        .game-button {
            @apply bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition-all duration-200;
        }
        /* สไตล์สำหรับข้อความ feedback */
        .feedback {
            @apply h-6 mt-2 text-sm font-semibold;
        }
        .feedback.correct {
            color: #16a34a; /* green-600 */
        }
        .feedback.incorrect {
            color: #dc2626; /* red-600 */
        }
        .task-card {
            @apply bg-gray-50 p-4 rounded-lg border border-gray-200 shadow-sm mb-3;
        }
        .task-card.completed {
            @apply bg-green-50 border-green-200;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden">
        <header class="p-6 bg-gray-800 text-white">
            <h1 class="text-3xl font-bold text-center">เกมปริศนาเวกเตอร์ (Vector Games)</h1>
            <p class="text-center text-gray-300 mt-1">เลือกระหว่างเกมภารกิจกู้ภัย หรือ เกมออกแบบเมือง</p>
        </header>

        <!-- แท็บสำหรับสลับเกม -->
        <div class="flex border-b border-gray-200">
            <button id="tab1" class="tab-button active flex-1 py-4 px-6 text-center text-gray-500 hover:bg-gray-50 transition-all duration-200" onclick="switchTab('game1', 'tab1')">
                เกมที่ 1: ภารกิจกู้ภัย
            </button>
            <button id="tab2" class="tab-button flex-1 py-4 px-6 text-center text-gray-500 hover:bg-gray-50 transition-all duration-200" onclick="switchTab('game2', 'tab2')">
                เกมที่ 2: ออกแบบเมือง Vectoria
            </button>
        </div>

        <!-- เนื้อหาเกมที่ 1 -->
        <div id="game1" class="tab-content p-4 md:p-8">
            <div class="flex flex-col md:flex-row gap-6">
                <!-- ส่วนของโจทย์ -->
                <div class="flex-1">
                    <h2 class="text-2xl font-bold mb-4 text-blue-600">ภารกิจกู้ภัย</h2>
                    <p class="mb-4 text-gray-700">คุณคือทีมกู้ภัยที่เริ่มต้นที่ค่ายหลัก (0, 0) จงทำตามคำใบ้ทีละขั้นตอนเพื่อค้นหาผู้รอดชีวิต!</p>
                    
                    <div class="space-y-4">
                        <!-- คำใบ้ที่ 1 -->
                        <div id="prompt1-container" class="task-card">
                            <p class="font-semibold">คำใบ้ที่ 1:</p>
                            <p>เดินทางไปตามเวกเตอร์ $\vec{u} = 2\vec{i} + 3\vec{j}$ เพื่อไปยัง 'จุด A' (จุดพักแรก) จงหาพิกัดของจุด A</p>
                            <div class="mt-2 flex items-center gap-2">
                                ( <input type="number" id="q1-x" class="game-input" placeholder="X"> , 
                                <input type="number" id="q1-y" class="game-input" placeholder="Y"> )
                                <button class="game-button" onclick="checkAnswer1(1)">ตรวจสอบ</button>
                            </div>
                            <p id="feedback1" class="feedback"></p>
                        </div>

                        <!-- คำใบ้ที่ 2 -->
                        <div id="prompt2-container" class="task-card hidden">
                            <p class="font-semibold">คำใบ้ที่ 2:</p>
                            <p>ยอดเยี่ยม! ตอนนี้คุณอยู่ที่จุด A (2, 3) จากจุด A เดินทางต่อไปยัง 'จุด B' ด้วยเวกเตอร์ $\vec{v} = 4\vec{i} - 3\vec{j}$ จงหาพิกัดของจุด B</p>
                            <div class="mt-2 flex items-center gap-2">
                                ( <input type="number" id="q2-x" class="game-input" placeholder="X"> , 
                                <input type="number" id="q2-y" class="game-input" placeholder="Y"> )
                                <button class="game-button" onclick="checkAnswer1(2)">ตรวจสอบ</button>
                            </div>
                            <p id="feedback2" class="feedback"></p>
                        </div>

                        <!-- คำใบ้ที่ 3 -->
                        <div id="prompt3-container" class="task-card hidden">
                            <p class="font-semibold">คำใบ้ที่ 3:</p>
                            <p>ถึงจุด B (6, 0) แล้ว! คุณต้องข้ามเหวที่กว้างเท่ากับ "ขนาด" ของเวกเตอร์การเดินทางจาก A ไป B (คือ $|\vec{v}|$) จงหาความกว้างของเหว</p>
                            <div class="mt-2 flex items-center gap-2">
                                <input type="number" id="q3-ans" class="game-input w-32" placeholder="ขนาด">
                                <button class="game-button" onclick="checkAnswer1(3)">ตรวจสอบ</button>
                            </div>
                            <p id="feedback3" class="feedback"></p>
                        </div>

                        <!-- คำใบ้ที่ 4 -->
                        <div id="prompt4-container" class="task-card hidden">
                            <p class="font-semibold">คำใบ้ที่ 4:</p>
                            <p>คุณข้ามเหวมาได้! ที่นี่มีป้ายบอกทางไปยัง 'จุด C' ซึ่งอยู่ห่างจากจุด B (6, 0) ไปในทิศทาง *ตรงกันข้าม* กับเวกเตอร์ $\vec{w} = -3\vec{i} + 4\vec{j}$ เป็นระยะทาง 10 หน่วย จงหาพิกัดของจุด C</p>
                            <div class="mt-2 flex items-center gap-2">
                                ( <input type="number" id="q4-x" class="game-input" placeholder="X"> , 
                                <input type="number" id="q4-y" class="game-input" placeholder="Y"> )
                                <button class="game-button" onclick="checkAnswer1(4)">ตรวจสอบ</button>
                            </div>
                            <p id="feedback4" class="feedback"></p>
                        </div>

                        <!-- คำใบ้ที่ 5 -->
                        <div id="prompt5-container" class="task-card hidden">
                            <p class="font-semibold">คำใบ้ที่ 5 (สุดท้าย):</p>
                            <p>ใกล้แล้ว! ผู้รอดชีวิตอยู่ที่ 'จุด D' เรารู้แค่ว่าเวกเตอร์จากค่ายหลักไปยังจุด D ($\vec{OD}$) *ตั้งฉาก* กับเวกเตอร์ $\vec{v}$ (จากคำใบ้ที่ 2) และเรารู้ว่าพิกัด $x$ ของจุด D คือ 3 จงหาพิกัด $y$ ของจุด D (ตอบพิกัดเต็มของ D)</p>
                            <div class="mt-2 flex items-center gap-2">
                                ( <input type="number" id="q5-x" class="game-input" value="3" disabled> , 
                                <input type="number" id="q5-y" class="game-input" placeholder="Y"> )
                                <button class="game-button" onclick="checkAnswer1(5)">ตรวจสอบ</button>
                            </div>
                            <p id="feedback5" class="feedback"></p>
                        </div>
                         
                         <p id="success-msg-1" class="hidden text-2xl font-bold text-center text-green-600 p-4 bg-green-100 rounded-lg">ยินดีด้วย! คุณพบผู้รอดชีวิตแล้ว!</p>

                    </div>
                </div>
                <!-- ส่วนของแผนที่ -->
                <div class="flex-shrink-0">
                    <h3 class="text-xl font-semibold text-center mb-2">แผนที่ภารกิจ</h3>
                    <canvas id="canvas1" width="400" height="400" class="border-2 border-gray-400 bg-white rounded-lg shadow-md"></canvas>
                </div>
            </div>
        </div>

        <!-- เนื้อหาเกมที่ 2 -->
        <div id="game2" class="tab-content hidden p-4 md:p-8">
            <div class="flex flex-col md:flex-row gap-6">
                <!-- ส่วนของโจทย์ -->
                <div class="flex-1">
                    <h2 class="text-2xl font-bold mb-4 text-indigo-600">ออกแบบเมือง Vectoria</h2>
                    <p class="mb-4 text-gray-700">คุณคือผู้วางผังเมือง จงวางสิ่งก่อสร้างและตรวจสอบเงื่อนไขต่างๆ ให้ถูกต้อง (คุณสามารถทำภารกิจไม่เรียงลำดับได้ แต่บางภารกิจอาจต้องใช้ข้อมูลจากภารกิจก่อนหน้า)</p>
                    
                    <div class="space-y-3">
                        <!-- ภารกิจ 1 -->
                        <div id="task1-card" class="task-card">
                            <p class="font-semibold">ภารกิจ 1: สร้าง 'ศาลากลาง' (H) ที่พิกัด (1, 2)</p>
                            <div class="mt-2 flex items-center gap-2">
                                ( <input type="number" id="t1-x" class="game-input" value="1"> , 
                                <input type="number" id="t1-y" class="game-input" value="2"> )
                                <button class="game-button" onclick="checkTask2(1)">สร้าง</button>
                            </div>
                            <p id="feedback-t1" class="feedback"></p>
                        </div>

                        <!-- ภารกิจ 2 -->
                        <div id="task2-card" class="task-card">
                            <p class="font-semibold">ภารกิจ 2: สร้าง 'โรงเรียน' (S) โดยมีเวกเตอร์ตำแหน่ง $\vec{OS} = -3\vec{i} + 5\vec{j}$ จงระบุพิกัด</p>
                            <div class="mt-2 flex items-center gap-2">
                                ( <input type="number" id="t2-x" class="game-input" placeholder="X"> , 
                                <input type="number" id="t2-y" class="game-input" placeholder="Y"> )
                                <button class="game-button" onclick="checkTask2(2)">สร้าง</button>
                            </div>
                            <p id="feedback-t2" class="feedback"></p>
                        </div>

                        <!-- ภารกิจ 3 -->
                        <div id="task3-card" class="task-card">
                            <p class="font-semibold">ภารกิจ 3: สร้าง 'โรงพยาบาล' (P) โดยที่เวกเตอร์จากโรงเรียน (S) ไปยังโรงพยาบาล ( $\vec{SP}$ ) คือ $\vec{v} = 7\vec{i} - 2\vec{j}$ จงหาพิกัดของ P</p>
                            <div class="mt-2 flex items-center gap-2">
                                ( <input type="number" id="t3-x" class="game-input" placeholder="X"> , 
                                <input type="number" id="t3-y" class="game-input" placeholder="Y"> )
                                <button class="game-button" onclick="checkTask2(3)">สร้าง</button>
                            </div>
                            <p id="feedback-t3" class="feedback"></p>
                        </div>
                        
                        <!-- ภารกิจ 4 -->
                        <div id="task4-card" class="task-card">
                            <p class="font-semibold">ภารกิจ 4: ถนนที่เชื่อมระหว่าง 'ศาลากลาง' (H) กับ 'โรงพยาบาล' (P) (คือ $\vec{HP}$) ขนานกับแนวสายเคเบิล $\vec{d} = 3\vec{i} + 1\vec{j}$ หรือไม่?</p>
                            <div class="mt-2 flex items-center gap-2">
                                <select id="t4-ans" class="game-input w-32">
                                    <option value="">เลือกคำตอบ</option>
                                    <option value="yes">ใช่ (ขนานกัน)</option>
                                    <option value="no">ไม่ (ไม่ขนาน)</option>
                                </select>
                                <button class="game-button" onclick="checkTask2(4)">ตรวจสอบ</button>
                            </div>
                            <p id="feedback-t4" class="feedback"></p>
                        </div>
                        
                        <!-- ภารกิจ 5 -->
                        <div id="task5-card" class="task-card">
                            <p class="font-semibold">ภารกิจ 5: ถนน $\vec{HP}$ *ตั้งฉาก* กับแนวสายเคเบิล $\vec{d} = 3\vec{i} + 1\vec{j}$ หรือไม่?</p>
                            <div class="mt-2 flex items-center gap-2">
                                <select id="t5-ans" class="game-input w-32">
                                    <option value="">เลือกคำตอบ</option>
                                    <option value="yes">ใช่ (ตั้งฉาก)</option>
                                    <option value="no">ไม่ (ไม่ตั้งฉาก)</option>
                                </select>
                                <button class="game-button" onclick="checkTask2(5)">ตรวจสอบ</button>
                            </div>
                            <p id="feedback-t5" class="feedback"></p>
                        </div>

                        <!-- ภารกิจ 6 -->
                        <div id="task6-card" class="task-card">
                            <p class="font-semibold">ภารกิจ 6: จงหาพื้นที่ของ 'สวนสาธารณะ' รูปสามเหลี่ยม ที่มีมุมอยู่ที่ ศาลากลาง (H), โรงเรียน (S), และโรงพยาบาล (P)</p>
                            <div class="mt-2 flex items-center gap-2">
                                <input type="number" id="t6-ans" class="game-input w-32" placeholder="พื้นที่">
                                <button class="game-button" onclick="checkTask2(6)">ตรวจสอบ</button>
                            </div>
                            <p id="feedback-t6" class="feedback"></p>
                        </div>
                        
                        <p id="success-msg-2" class="hidden text-2xl font-bold text-center text-indigo-600 p-4 bg-indigo-100 rounded-lg">ยินดีด้วย! คุณออกแบบเมืองเสร็จแล้ว!</p>
                    </div>
                </div>
                <!-- ส่วนของแผนที่ -->
                <div class="flex-shrink-0">
                    <h3 class="text-xl font-semibold text-center mb-2">แผนผังเมือง Vectoria</h3>
                    <canvas id="canvas2" width="400" height="400" class="border-2 border-gray-400 bg-white rounded-lg shadow-md"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- โหลด MathJax สำหรับแสดงผลคณิตศาสตร์ -->
    <!-- (ถูกย้ายไป <head> แล้ว) -->
    
    <script>
        // --- การตั้งค่าทั่วไป ---
        let canvas1, ctx1, canvas2, ctx2;
        const scale = 20; // 20 pixels ต่อ 1 หน่วย
        let centerX1, centerY1, centerX2, centerY2;

        document.addEventListener('DOMContentLoaded', () => {
            // ตั้งค่า Canvas 1
            canvas1 = document.getElementById('canvas1');
            ctx1 = canvas1.getContext('2d');
            centerX1 = canvas1.width / 2;
            centerY1 = canvas1.height / 2;
            drawGrid(ctx1, canvas1.width, canvas1.height, centerX1, centerY1, scale);
            plotPoint(ctx1, 0, 0, 'blue', 'ค่าย', centerX1, centerY1); // <-- แก้ไขบรรทัดนี้

            // ตั้งค่า Canvas 2
            canvas2 = document.getElementById('canvas2');
            ctx2 = canvas2.getContext('2d');
            centerX2 = canvas2.width / 2;
            centerY2 = canvas2.height / 2;
            drawGrid(ctx2, canvas2.width, canvas2.height, centerX2, centerY2, scale);
            plotPoint(ctx2, 0, 0, 'gray', 'O', centerX2, centerY2); // <-- และแก้ไขบรรทัดนี้
            
            // โหลด MathJax
            // (ลบออกจากที่นี่ เพราะจัดการใน <head> แล้ว)
        });

        // --- ฟังก์ชันวาดแผนที่ (Grid) ---
        function drawGrid(ctx, w, h, centerX, centerY, gridScale) {
            ctx.clearRect(0, 0, w, h);
            ctx.strokeStyle = '#e5e7eb'; // gray-200
            ctx.lineWidth = 0.5;

            // วาดเส้นตารางแนวตั้ง
            for (let x = centerX + gridScale; x < w; x += gridScale) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, h);
                ctx.stroke();
            }
            for (let x = centerX - gridScale; x > 0; x -= gridScale) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, h);
                ctx.stroke();
            }
            // วาดเส้นตารางแนวนอน
            for (let y = centerY + gridScale; y < h; y += gridScale) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(w, y);
                ctx.stroke();
            }
            for (let y = centerY - gridScale; y > 0; y -= gridScale) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(w, y);
                ctx.stroke();
            }

            // วาดแกน X และ Y
            ctx.strokeStyle = '#9ca3af'; // gray-400
            ctx.lineWidth = 2;
            // แกน X
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(w, centerY);
            ctx.stroke();
            // แกน Y
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, h);
            ctx.stroke();
        }

        // --- ฟังก์ชันวาดจุดบนแผนที่ ---
        function plotPoint(ctx, x, y, color, label, targetCenterX, targetCenterY) {
            const drawX = targetCenterX + (x * scale);
            const drawY = targetCenterY - (y * scale); // แกน Y ของ canvas กลับด้าน

            // วาดจุด
            ctx.beginPath();
            ctx.arc(drawX, drawY, 6, 0, 2 * Math.PI);
            ctx.fillStyle = color;
            ctx.fill();
            
            // วาดป้ายชื่อ
            ctx.fillStyle = '#1f2937'; // gray-800
            ctx.font = 'bold 14px Sarabun';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'bottom';
            ctx.fillText(`${label} (${x}, ${y})`, drawX + 8, drawY - 8);
        }
        
        // --- ฟังก์ชันวาดเวกเตอร์ ---
        function drawVector(ctx, x1, y1, x2, y2, color, targetCenterX, targetCenterY) {
            const startX = targetCenterX + (x1 * scale);
            const startY = targetCenterY - (y1 * scale);
            const endX = targetCenterX + (x2 * scale);
            const endY = targetCenterY - (y2 * scale);
            
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            
            // วาดหัวลูกศร
            const headlen = 10;
            const angle = Math.atan2(endY - startY, endX - startX);
            ctx.lineTo(endX - headlen * Math.cos(angle - Math.PI / 6), endY - headlen * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(endX, endY);
            ctx.lineTo(endX - headlen * Math.cos(angle + Math.PI / 6), endY - headlen * Math.sin(angle + Math.PI / 6));
            
            ctx.stroke();
        }

        // --- ฟังก์ชันสลับแท็บ ---
        function switchTab(gameId, tabId) {
            // ซ่อนเนื้อหาทั้งหมด
            document.getElementById('game1').classList.add('hidden');
            document.getElementById('game2').classList.add('hidden');
            // ลบ active class จากแท็บทั้งหมด
            document.getElementById('tab1').classList.remove('active');
            document.getElementById('tab2').classList.remove('active');
            
            // แสดงเนื้อหาและแท็บที่เลือก
            document.getElementById(gameId).classList.remove('hidden');
            document.getElementById(tabId).classList.add('active');

            // สั่งให้ MathJax render แท็บที่เพิ่งเปิดใหม่
            if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                MathJax.typesetPromise([document.getElementById(gameId)]);
            }
        }

        // --- ลอจิกเกมที่ 1 ---
        let currentQuestion1 = 1;
        let pointA = {}, pointB = {}, pointC = {}, pointD = {};
        
        function checkAnswer1(questionNum) {
            if (questionNum !== currentQuestion1) return;

            let x, y, ans;
            const feedbackEl = document.getElementById(`feedback${questionNum}`);
            let isCorrect = false;

            try {
                switch (questionNum) {
                    case 1:
                        x = parseFloat(document.getElementById('q1-x').value);
                        y = parseFloat(document.getElementById('q1-y').value);
                        if (x === 2 && y === 3) {
                            isCorrect = true;
                            pointA = {x: 2, y: 3};
                            plotPoint(ctx1, 2, 3, '#ef4444', 'A', centerX1, centerY1); // red-500
                            drawVector(ctx1, 0, 0, 2, 3, '#f87171', centerX1, centerY1);
                        }
                        break;
                    case 2:
                        x = parseFloat(document.getElementById('q2-x').value);
                        y = parseFloat(document.getElementById('q2-y').value);
                        // B = A + v = (2+4, 3-3) = (6, 0)
                        if (x === 6 && y === 0) {
                            isCorrect = true;
                            pointB = {x: 6, y: 0};
                            plotPoint(ctx1, 6, 0, '#ef4444', 'B', centerX1, centerY1);
                            drawVector(ctx1, pointA.x, pointA.y, 6, 0, '#f87171', centerX1, centerY1);
                        }
                        break;
                    case 3:
                        ans = parseFloat(document.getElementById('q3-ans').value);
                        // |v| = sqrt(4^2 + (-3)^2) = sqrt(16 + 9) = sqrt(25) = 5
                        if (ans === 5) {
                            isCorrect = true;
                        }
                        break;
                    case 4:
                        x = parseFloat(document.getElementById('q4-x').value);
                        y = parseFloat(document.getElementById('q4-y').value);
                        // |w| = sqrt((-3)^2 + 4^2) = 5
                        // unit_w = (-3/5, 4/5)
                        // opposite direction, 10 units: 10 * -unit_w = 10 * (3/5, -4/5) = (6, -8)
                        // C = B + (6, -8) = (6+6, 0-8) = (12, -8)
                        if (x === 12 && y === -8) {
                            isCorrect = true;
                            pointC = {x: 12, y: -8};
                            plotPoint(ctx1, 12, -8, '#ef4444', 'C', centerX1, centerY1);
                            drawVector(ctx1, pointB.x, pointB.y, 12, -8, '#f87171', centerX1, centerY1);
                        }
                        break;
                    case 5:
                        x = 3;
                        y = parseFloat(document.getElementById('q5-y').value);
                        // v = (4, -3)
                        // OD = (3, y)
                        // OD . v = 0 => (3)(4) + (y)(-3) = 0 => 12 - 3y = 0 => 3y = 12 => y = 4
                        if (y === 4) {
                            isCorrect = true;
                            pointD = {x: 3, y: 4};
                            plotPoint(ctx1, 3, 4, '#16a34a', 'D (ผู้รอดชีวิต)', centerX1, centerY1); // green-600
                            document.getElementById('success-msg-1').classList.remove('hidden');
                        }
                        break;
                }
            } catch (e) {
                isCorrect = false;
            }

            if (isCorrect) {
                feedbackEl.textContent = 'ถูกต้อง!';
                feedbackEl.className = 'feedback correct';
                document.getElementById(`prompt${questionNum}-container`).classList.add('completed');
                
                // เลื่อนไปยังคำใบ้ถัดไป
                currentQuestion1++;
                if (currentQuestion1 <= 5) {
                    document.getElementById(`prompt${currentQuestion1}-container`).classList.remove('hidden');
                    // โหลด MathJax สำหรับโจทย์ข้อใหม่
                    if (typeof MathJax !== 'undefined') {
                        MathJax.typesetPromise([`prompt${currentQuestion1}-container`]);
                    }
                }
            } else {
                feedbackEl.textContent = 'ผิดพลาด! ลองอีกครั้ง';
                feedbackEl.className = 'feedback incorrect';
            }
        }
        
        // --- ลอจิกเกมที่ 2 ---
        let game2State = {
            locations: {},
            tasksCompleted: 0
        };

        function checkTask2(taskNum) {
            const feedbackEl = document.getElementById(`feedback-t${taskNum}`);
            const cardEl = document.getElementById(`task${taskNum}-card`);
            let isCorrect = false;
            let x, y, ans;
            
            try {
                switch (taskNum) {
                    case 1:
                        x = parseFloat(document.getElementById('t1-x').value);
                        y = parseFloat(document.getElementById('t1-y').value);
                        if (x === 1 && y === 2) {
                            isCorrect = true;
                            game2State.locations['H'] = {x: 1, y: 2};
                            plotPoint(ctx2, 1, 2, '#3b82f6', 'H (ศาลากลาง)', centerX2, centerY2);
                        }
                        break;
                    case 2:
                        x = parseFloat(document.getElementById('t2-x').value);
                        y = parseFloat(document.getElementById('t2-y').value);
                        if (x === -3 && y === 5) {
                            isCorrect = true;
                            game2State.locations['S'] = {x: -3, y: 5};
                            plotPoint(ctx2, -3, 5, '#10b981', 'S (โรงเรียน)', centerX2, centerY2);
                        }
                        break;
                    case 3:
                        if (!game2State.locations['S']) {
                            feedbackEl.textContent = 'ต้องสร้างโรงเรียน (ภารกิจ 2) ก่อน!';
                            feedbackEl.className = 'feedback incorrect';
                            return;
                        }
                        x = parseFloat(document.getElementById('t3-x').value);
                        y = parseFloat(document.getElementById('t3-y').value);
                        // P = S + v = (-3+7, 5-2) = (4, 3)
                        if (x === 4 && y === 3) {
                            isCorrect = true;
                            game2State.locations['P'] = {x: 4, y: 3};
                            plotPoint(ctx2, 4, 3, '#ef4444', 'P (โรงพยาบาล)', centerX2, centerY2);
                        }
                        break;
                    case 4:
                        if (!game2State.locations['H'] || !game2State.locations['P']) {
                            feedbackEl.textContent = 'ต้องสร้าง H และ P (ภารกิจ 1, 3) ก่อน!';
                            feedbackEl.className = 'feedback incorrect';
                            return;
                        }
                        ans = document.getElementById('t4-ans').value;
                        // HP = P - H = (4-1, 3-2) = (3, 1)
                        // d = (3, 1)
                        // HP = k*d ? (3, 1) = k(3, 1) => k=1. ใช่, ขนานกัน
                        // *** ผมขอเปลี่ยนโจทย์ในโค้ดเล็กน้อยเพื่อให้คำตอบเป็น "ไม่" เพื่อให้ข้อ 4 กับ 5 น่าสนใจขึ้น
                        // ให้ d = (2, 1) ตามไอเดียเดิม
                        // HP = (3, 1). d = (2, 1). 
                        // (3,1) = k(2,1)? 3=2k และ 1=k. ไม่จริง
                        // ดังนั้นคำตอบที่ถูกคือ "no"
                        // ** แก้โจทย์ใน HTML ให้ d = (2, 1) ... อ๊ะ ผมแก้โจทย์ใน HTML เป็น (3, 1) ไปแล้ว งั้นเอางี้
                        // ** โจทย์ใน HTML คือ d = (3, 1)
                        // ** HP = (3, 1)
                        // ** คำตอบที่ถูกคือ "yes" (ใช่)
                        if (ans === 'yes') { 
                            isCorrect = true;
                            drawVector(ctx2, 1, 2, 4, 3, '#a855f7', centerX2, centerY2); // purple-500
                        }
                        break;
                    case 5:
                         if (!game2State.locations['H'] || !game2State.locations['P']) {
                            feedbackEl.textContent = 'ต้องสร้าง H และ P (ภารกิจ 1, 3) ก่อน!';
                            feedbackEl.className = 'feedback incorrect';
                            return;
                        }
                        ans = document.getElementById('t5-ans').value;
                        // HP = (3, 1)
                        // d = (3, 1)
                        // HP . d = (3)(3) + (1)(1) = 9 + 1 = 10
                        // 10 != 0 ดังนั้น "ไม่" ตั้งฉาก
                        if (ans === 'no') {
                            isCorrect = true;
                        }
                        break;
                    case 6:
                        if (!game2State.locations['H'] || !game2State.locations['S'] || !game2State.locations['P']) {
                            feedbackEl.textContent = 'ต้องสร้าง H, S, และ P (ภารกิจ 1, 2, 3) ก่อน!';
                            feedbackEl.className = 'feedback incorrect';
                            return;
                        }
                        ans = parseFloat(document.getElementById('t6-ans').value);
                        // H(1,2), S(-3,5), P(4,3)
                        // v1 = HS = S - H = (-3-1, 5-2) = (-4, 3)
                        // v2 = HP = P - H = (4-1, 3-2) = (3, 1)
                        // Area = 0.5 * |x1*y2 - x2*y1|
                        // Area = 0.5 * |(-4)(1) - (3)(3)| = 0.5 * |-4 - 9| = 0.5 * |-13| = 6.5
                        if (ans === 6.5) {
                            isCorrect = true;
                        }
                        break;
                }
            } catch (e) {
                isCorrect = false;
            }
            
            if (isCorrect) {
                feedbackEl.textContent = 'ภารกิจสำเร็จ!';
                feedbackEl.className = 'feedback correct';
                if (!cardEl.classList.contains('completed')) {
                    cardEl.classList.add('completed');
                    game2State.tasksCompleted++;
                }
                
                // ตรวจสอบว่าจบเกมหรือยัง
                if (game2State.tasksCompleted === 6) {
                    document.getElementById('success-msg-2').classList.remove('hidden');
                }
            } else {
                 if (feedbackEl.textContent === '') { // ป้องกันการเขียนทับ error message ที่เจาะจง
                    feedbackEl.textContent = 'ผิดพลาด! ลองอีกครั้ง';
                    feedbackEl.className = 'feedback incorrect';
                 }
            }
        }

    </script>
</body>
</html>
